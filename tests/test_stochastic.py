from unittest import main, TestCase

from numpy import asarray, log

from pyrad.clouds.stochastic import overlap_parameter, TotalWaterPDF


class TestStochasticClouds(TestCase):

    def test_era5(self):
        cloud_fraction = asarray([0., 0., 0., 0.,
                                  0., 0., 0., 0.,
                                  0., 0., 0., 0.,
                                  0., 0., 0., 0.,
                                  0.42187905, 0.71093953, 0.45313048, 0.17968047,
                                  0.20311904, 0.16407001, 0.22655761, 0.5859338,
                                  0.90624571, 0.35156333, 0., 0.12500572,
                                  0.75781667, 0.89061999, 0.88280714, 0.93749714,
                                  0.94531, 0.99218714, 0.77344239, 0.,
                                  0.00781286])
        lwc = asarray([0., 0., 0., 0.,
                       0., 0., 0., 0.,
                       0., 0., 0., 0.,
                       0., 0., 0., 0.,
                       0., 0., 0., 0.,
                       0., 0., 7.24514817e-07, 3.14834621e-05,
                       1.00147707e-04, 1.00114775e-05, 9.55042259e-07, 3.14834621e-05,
                       1.31137182e-04, 1.07294058e-04, 6.96192874e-05, 3.62257409e-05,
                       6.68529581e-06, 1.41609714e-06, 5.73025355e-06, 0.,
                       0.])
        iwc = asarray([0., 0., 0., 0.,
                       0., 0., 0., 0.,
                       0., 0., 0., 0.,
                       0., 0., 0., 0.,
                       2.44657998e-07, 8.11449028e-06, 1.47814207e-05, 4.28151497e-06,
                       4.77083097e-06, 5.36208780e-06, 1.03775768e-05, 2.62191822e-05,
                       4.48131900e-05, 2.10405879e-05, 2.69123798e-06, 2.38541548e-06,
                       1.14989259e-05, 2.05716600e-05, 2.22842660e-05, 2.26512530e-05,
                       2.21823252e-05, 2.04697192e-05, 1.81250800e-05, 2.01842849e-06,
                       1.22328999e-07])
        pressure = asarray([1., 2., 3., 5.,
                            7., 10., 20., 30.,
                            50., 70., 100., 125.,
                            150., 175., 200., 225.,
                            250., 300., 350., 400.,
                            450., 500., 550., 600.,
                            650., 700., 750., 775.,
                            800., 825., 850., 875.,
                            900., 925., 950., 975.,
                            1000.])
        z = log(pressure)
        scale_height, p, q = 2, 5, 5
        alpha = overlap_parameter(z, scale_height)
        pdf = TotalWaterPDF(p, q)
        ql, qi = pdf.sample_condensate(cloud_fraction, lwc, iwc, alpha)


if __name__ == "__main__":
    main()
